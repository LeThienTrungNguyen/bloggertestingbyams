<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Quản Lý Nội Dung</title>
    <!-- Tải Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Tải Firebase SDK (phiên bản 11.6.1) --><script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, orderBy, getDocs, addDoc, updateDoc, deleteDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- 1. Thiết lập Firebase và Biến Toàn Cục ---
        setLogLevel('debug');

        // KIỂM TRA MÔI TRƯỜNG: Xác định xem có phải đang chạy trong môi trường Canvas hay không.
        const isLocalMode = typeof __firebase_config === 'undefined';
        
        const appId = isLocalMode ? 'LOCAL_TEST_ID' : (typeof __app_id !== 'undefined' ? __app_id : 'default-app-id');
        const firebaseConfig = isLocalMode ? null : JSON.parse(__firebase_config);
        const initialAuthToken = isLocalMode ? null : (typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null);

        let app;
        let db;
        let auth;
        let userId = 'loading'; // ID người dùng hiện tại
        let isAuthReady = false;
        let posts = []; // Biến lưu trữ danh sách bài viết
        let postInEdit = null; // Bài viết đang được chỉnh sửa

        // Dữ liệu tĩnh ban đầu cho chế độ kiểm thử cục bộ
        const initialLocalPosts = [
            { id: 'p1', title: 'Bài viết Demo 1 (Local)', content: '<p>Đây là nội dung thử nghiệm. Mọi người đều có thể tạo bài viết mới.</p>', youtubeLink: '', authorId: 'LOCAL_ADMIN_UID_12345', timestamp: new Date(Date.now() - 86400000) },
            { id: 'p2', title: 'Bài viết Demo 2 (Local)', content: '<p>Nếu bạn tạo bài viết, nó sẽ hiển thị ngay tại đây!</p>', youtubeLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ', authorId: 'LOCAL_USER_A_67890', timestamp: new Date() },
        ];


        // --- 2. Khởi tạo Firebase và Xác thực ---
        async function initializeFirebase() {
            if (isLocalMode) {
                // CHẾ ĐỘ CỤC BỘ: Bỏ qua Firebase. Gán ID người dùng ngẫu nhiên để mô phỏng người dùng BẤT KỲ.
                // Điều này cho phép người dùng tạo bài viết và chỉ sửa/xóa bài của họ.
                userId = 'LOCAL_USER_' + Math.random().toString(36).substring(2, 9).toUpperCase(); 
                isAuthReady = true;
                console.warn("Chế độ kiểm thử cục bộ: Bỏ qua kết nối Firebase. Cho phép mọi người dùng cục bộ tạo bài viết.");
                updateUI();
                setupRealtimeListener(); 
                return;
            }
            
            // --- THIẾT LẬP FIREBASE CHUẨN (Trong Canvas) ---
            if (!firebaseConfig) {
                console.error("Firebase config is missing.");
                return;
            }

            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Đăng nhập/Xác thực người dùng
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    if (initialAuthToken) {
                        try {
                            await signInWithCustomToken(auth, initialAuthToken);
                            userId = auth.currentUser.uid;
                        } catch (error) {
                            console.error("Lỗi xác thực bằng Custom Token:", error);
                            await signInAnonymously(auth);
                            userId = auth.currentUser.uid;
                        }
                    } else {
                        await signInAnonymously(auth);
                        userId = auth.currentUser?.uid || crypto.randomUUID();
                    }
                }
                
                isAuthReady = true;
                // Bắt đầu lắng nghe dữ liệu sau khi xác thực xong
                setupRealtimeListener();
                updateUI();
                console.log("Firebase đã sẵn sàng. User ID:", userId);
            });
        }

        // --- 3. Logic Firestore (CRUD) ---

        /**
         * Hàm tiện ích để đảm bảo URL có giao thức (protocol)
         * Khắc phục lỗi khi chạy cục bộ (file:///)
         */
        function normalizeUrl(url) {
            if (!url) return '';
            const trimmedUrl = url.trim();
            if (!trimmedUrl) return '';
            
            // Nếu URL không bắt đầu bằng http:// hoặc https://, giả định là https://
            if (!/^https?:\/\//i.test(trimmedUrl)) {
                // Kiểm tra xem nó có chứa dấu chấm nào không để tránh thêm https:// vào các chuỗi không phải URL
                if (trimmedUrl.includes('.')) {
                    return 'https://' + trimmedUrl;
                }
            }
            return trimmedUrl;
        }

        // Hàm lấy đường dẫn Collection cho bài viết công khai
        function getPostsCollectionRef() {
            if (!db) return null; // Tránh lỗi nếu db chưa được khởi tạo
            return collection(db, `artifacts/${appId}/public/data/posts`);
        }

        // Lắng nghe bài viết theo thời gian thực
        function setupRealtimeListener() {
            if (isLocalMode) {
                // Dữ liệu giả định cho chế độ Local Testing
                if (posts.length === 0) {
                    // Sao chép sâu dữ liệu ban đầu
                    posts = initialLocalPosts.map(p => ({...p})); 
                }
                // Sắp xếp thủ công theo timestamp giảm dần
                posts.sort((a, b) => b.timestamp - a.timestamp);
                updatePostListUI();
                return;
            }

            const postsCollectionRef = getPostsCollectionRef();
            if (!postsCollectionRef) return;
            
            // Lấy tất cả bài viết, không dùng orderBy để tránh lỗi index
            const postsQuery = query(postsCollectionRef); 

            onSnapshot(postsQuery, (snapshot) => {
                const fetchedPosts = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    fetchedPosts.push({
                        id: doc.id,
                        title: data.title || 'Bài viết không tiêu đề',
                        content: data.content || '',
                        youtubeLink: data.youtubeLink || '',
                        authorId: data.authorId || '',
                        timestamp: data.timestamp ? data.timestamp.toDate() : new Date(0)
                    });
                });
                // Sắp xếp thủ công theo timestamp giảm dần
                posts = fetchedPosts.sort((a, b) => b.timestamp - a.timestamp); 
                updatePostListUI();
            }, (error) => {
                console.error("Lỗi khi lắng nghe bài viết:", error);
                document.getElementById('post-list').innerHTML = `<p class="text-red-500 p-4">Lỗi tải bài viết: ${error.message}</p>`;
            });
        }

        // Lưu bài viết (Tạo mới hoặc Cập nhật)
        async function savePost(title, content, rawYoutubeLink) {
            const isEditing = !!postInEdit;
            const saveButton = document.getElementById('save-post-btn');
            saveButton.textContent = 'Đang lưu...';
            saveButton.disabled = true;

            // Chuẩn hóa liên kết YouTube trước khi lưu
            const normalizedYoutubeLink = normalizeUrl(rawYoutubeLink);

            if (isLocalMode) {
                // --- CHẾ ĐỘ CỤC BỘ: SIMULATE CRUD ---
                const newPostData = {
                    title: title,
                    content: content,
                    youtubeLink: normalizedYoutubeLink, // Sử dụng link đã chuẩn hóa
                    timestamp: new Date(),
                    authorId: userId // Sử dụng userId cục bộ hiện tại
                };

                if (isEditing) {
                    // Cập nhật
                    const index = posts.findIndex(p => p.id === postInEdit.id);
                    if (index !== -1) {
                        posts[index] = { ...posts[index], ...newPostData };
                    }
                    showMessage('Đã giả lập cập nhật bài viết thành công!');
                } else {
                    // Tạo mới
                    const newId = 'p' + (posts.length + 1) + '-' + Date.now();
                    posts.push({ id: newId, ...newPostData });
                    showMessage('Đã giả lập tạo bài viết thành công!');
                }
                
                resetEditor();
                setupRealtimeListener(); // Sắp xếp lại và cập nhật UI
                saveButton.textContent = 'Lưu Bài Viết';
                saveButton.disabled = false;
                return;
            }

            // --- CHẾ ĐỘ CANVAS/FIREBASE ---
            const newPostData = {
                title: title,
                content: content, // Content là HTML từ div contenteditable
                youtubeLink: normalizedYoutubeLink, // Sử dụng link đã chuẩn hóa
                timestamp: new Date(),
            };

            try {
                if (postInEdit) {
                    // Cập nhật bài viết
                    const postRef = doc(db, getPostsCollectionRef().id, postInEdit.id);
                    await updateDoc(postRef, newPostData);
                    showMessage('Bài viết đã được cập nhật thành công!');
                } else {
                    // Tạo bài viết mới
                    await addDoc(getPostsCollectionRef(), {
                        ...newPostData,
                        authorId: userId,
                    });
                    showMessage('Bài viết đã được tạo thành công!');
                }
                resetEditor();
            } catch (error) {
                console.error("Lỗi khi lưu bài viết:", error);
                showMessage(`Lỗi: Không thể lưu bài viết. ${error.message}`, true);
            } finally {
                saveButton.textContent = 'Lưu Bài Viết';
                saveButton.disabled = false;
            }
        }

        // Xóa bài viết
        async function deletePost(postId) {
            if (isLocalMode) {
                showConfirm('Bạn có chắc chắn muốn xóa bài viết này không?', () => {
                    const index = posts.findIndex(p => p.id === postId);
                    if (index !== -1) {
                        posts.splice(index, 1);
                        showMessage('Đã giả lập xóa bài viết thành công!');
                        setupRealtimeListener(); // Cập nhật UI
                    } else {
                        showMessage('Không tìm thấy bài viết giả lập để xóa.', true);
                    }
                });
                return;
            }
            
            showConfirm('Bạn có chắc chắn muốn xóa bài viết này không?', async () => {
                try {
                    const postRef = doc(getPostsCollectionRef(), postId); 
                    await deleteDoc(postRef);
                    showMessage('Bài viết đã được xóa thành công!');
                } catch (error) {
                    console.error("Lỗi khi xóa bài viết:", error);
                    showMessage(`Lỗi: Không thể xóa bài viết. ${error.message}`, true);
                }
            });
        }
        
        // --- 4. Logic UI & Hiển thị ---

        // Cập nhật giao diện tổng thể (Admin vs User)
        function updateUI() {
            if (!isAuthReady) return;

            // Đổi tên từ admin-section thành post-creation-section để phù hợp với quyền "mọi người đều có thể đăng"
            const creationSection = document.getElementById('post-creation-section'); 
            const currentUserIdDisplay = document.getElementById('current-user-id');
            currentUserIdDisplay.textContent = `ID Người dùng hiện tại: ${userId}${isLocalMode ? ' (Chế độ cục bộ)' : ''}`;
            
            // Hiển thị phần tạo bài viết cho bất kỳ người dùng nào đã được xác thực/khởi tạo
            if (userId && userId !== 'loading') {
                creationSection.classList.remove('hidden');
            } else {
                creationSection.classList.add('hidden');
            }
        }

        // Tạo giao diện Admin (Editor)
        function showEditForm(post = null) {
            postInEdit = post;
            const editorTitle = document.getElementById('editor-title');
            const titleInput = document.getElementById('post-title');
            const contentEditor = document.getElementById('post-content-editor');
            const youtubeLinkInput = document.getElementById('youtube-link');
            const saveButton = document.getElementById('save-post-btn');
            
            if (post) {
                editorTitle.textContent = 'Chỉnh Sửa Bài Viết';
                titleInput.value = post.title;
                contentEditor.innerHTML = post.content; // Đặt HTML vào div
                youtubeLinkInput.value = post.youtubeLink;
                saveButton.textContent = 'Cập Nhật Bài Viết';
            } else {
                editorTitle.textContent = 'Viết Bài Mới';
                titleInput.value = '';
                contentEditor.innerHTML = ''; // Xóa nội dung
                youtubeLinkInput.value = '';
                saveButton.textContent = 'Lưu Bài Viết';
            }
            document.getElementById('edit-container').classList.remove('hidden');
            // Đặt focus vào editor
            contentEditor.focus(); 
        }

        function resetEditor() {
            postInEdit = null;
            document.getElementById('edit-container').classList.add('hidden');
            document.getElementById('post-title').value = '';
            document.getElementById('post-content-editor').innerHTML = '';
            document.getElementById('youtube-link').value = '';
        }

        // Cập nhật danh sách bài viết
        function updatePostListUI() {
            const listContainer = document.getElementById('post-list');
            listContainer.innerHTML = '';
            
            if (posts.length === 0) {
                listContainer.innerHTML = `<p class="p-6 text-center text-gray-500">Chưa có bài viết nào. Hãy tạo bài viết đầu tiên!</p>`;
                return;
            }

            posts.forEach(post => {
                const isAuthor = post.authorId === userId;
                const postElement = document.createElement('div');
                postElement.className = 'bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300 mb-6';

                // Lấy 8 ký tự đầu tiên của ID tác giả để hiển thị ngắn gọn
                const shortAuthorId = post.authorId ? post.authorId.substring(0, 8) + '...' : 'Ẩn danh';
                
                postElement.innerHTML = `
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">${post.title}</h2>
                    <p class="text-sm text-gray-500 mb-4">Ngày đăng: ${post.timestamp.toLocaleDateString()} | Tác giả: ${shortAuthorId}</p>
                    
                    <!-- Nội dung Preview (chỉ 3 dòng/150 ký tự) --><div id="content-preview-${post.id}" class="text-gray-600 line-clamp-3 mb-4 max-h-[4.5rem] overflow-hidden">
                        ${post.content}
                    </div>

                    <div id="content-full-${post.id}" class="text-gray-600 mb-4 hidden">
                        ${post.content}
                    </div>

                    <!-- Nút Đọc Thêm và Actions --><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                        <button 
                            id="read-more-btn-${post.id}"
                            class="read-more-btn bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300 mb-2 sm:mb-0"
                            data-post-id="${post.id}"
                        >
                            Đọc Thêm & Xem Video
                        </button>
                        
                        ${isAuthor ? `
                            <div class="space-x-2">
                                <button class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-600 transition" onclick="window.exposedFunctions.handleEdit('${post.id}')">Sửa</button>
                                <button class="bg-red-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-red-600 transition" onclick="window.exposedFunctions.deletePost('${post.id}')">Xóa</button>
                            </div>
                        ` : ''}
                    </div>
                `;
                listContainer.appendChild(postElement);
            });

            // Gán event listener cho nút Đọc Thêm sau khi các bài viết được tạo
            document.querySelectorAll('.read-more-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const postId = e.target.dataset.postId;
                    handleReadMore(postId);
                });
            });
        }

        // Xử lý nút "Đọc Thêm & Xem Video"
        function handleReadMore(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            const preview = document.getElementById(`content-preview-${postId}`);
            const full = document.getElementById(`content-full-${postId}`);
            const button = document.getElementById(`read-more-btn-${postId}`);

            if (full.classList.contains('hidden')) {
                // Mở rộng nội dung bài viết
                preview.classList.add('hidden');
                full.classList.remove('hidden');
                button.textContent = 'Thu Gọn';

                // Mở link YouTube trong tab mới, sử dụng hàm chuẩn hóa để đảm bảo có http/https
                if (post.youtubeLink) {
                    const finalLink = normalizeUrl(post.youtubeLink); 
                    if (finalLink) {
                        window.open(finalLink, '_blank');
                        showMessage('Đã mở liên kết YouTube trong tab mới!');
                    }
                }
            } else {
                // Thu gọn nội dung
                preview.classList.remove('hidden');
                full.classList.add('hidden');
                button.textContent = 'Đọc Thêm & Xem Video';
            }
        }

        // --- 5. Hàm tiện ích và Modal (thay thế alert/confirm) ---

        // Hiển thị thông báo
        function showMessage(message, isError = false) {
            const modal = document.getElementById('message-modal');
            const messageText = document.getElementById('message-text');
            messageText.textContent = message;
            
            if (isError) {
                modal.classList.add('bg-red-500');
                modal.classList.remove('bg-green-500');
            } else {
                modal.classList.add('bg-green-500');
                modal.classList.remove('bg-red-500');
            }

            modal.classList.remove('opacity-0', 'hidden');
            modal.classList.add('opacity-100');

            setTimeout(() => {
                modal.classList.add('opacity-0', 'hidden');
            }, 3000);
        }

        // Hiển thị xác nhận (thay thế confirm)
        function showConfirm(message, onConfirm) {
            const modal = document.getElementById('confirm-modal');
            document.getElementById('confirm-text').textContent = message;
            
            // Xóa listeners cũ và gán listener mới
            const confirmBtn = document.getElementById('confirm-yes');
            const cancelBtn = document.getElementById('confirm-no');

            const handleYes = () => {
                onConfirm();
                modal.classList.add('hidden');
                confirmBtn.removeEventListener('click', handleYes);
                cancelBtn.removeEventListener('click', handleNo);
            };

            const handleNo = () => {
                modal.classList.add('hidden');
                confirmBtn.removeEventListener('click', handleYes);
                cancelBtn.removeEventListener('click', handleNo);
            };

            confirmBtn.addEventListener('click', handleYes);
            cancelBtn.addEventListener('click', handleNo);

            modal.classList.remove('hidden');
        }

        // --- 6. Hỗ trợ Image/HTML Editing (Tính năng Admin) ---
        
        // Chức năng chèn thẻ Image đơn giản vào content editor (Kích hoạt upload file)
        function insertImageTag() {
            document.getElementById('image-upload-input').click();
        }

        // Xử lý tải ảnh lên và chuyển sang Base64
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const base64Image = e.target.result; // Data URL (Base64)
                
                // Construct the image tag using Base64 data. Kích thước mặc định 400x300.
                const imageTag = `<img src="${base64Image}" alt="Ảnh tải lên từ thiết bị" width="400" height="300" class="rounded-lg shadow-md mx-auto my-4 block"/>`;
                
                // Chèn trực tiếp vào div contenteditable
                const contentEditor = document.getElementById('post-content-editor');
                contentEditor.focus();
                
                // Sử dụng execCommand để chèn HTML tại vị trí con trỏ
                document.execCommand('insertHTML', false, imageTag);
                
                showMessage('Đã chèn ảnh vào nội dung. Ảnh hiển thị trực quan! Vui lòng chỉnh sửa kích thước (width/height) nếu cần.');
                // Reset file input để có thể chọn lại cùng một file
                event.target.value = null; 
            };
            reader.readAsDataURL(file);
        }
        
        // --- Khởi tạo ứng dụng khi DOM sẵn sàng ---
        window.addEventListener('load', initializeFirebase);
        
        // Phơi bày các hàm cần gọi từ HTML (on... attribute)
        window.exposedFunctions = {
            deletePost: (postId) => deletePost(postId),
            handleReadMore: (postId) => handleReadMore(postId),
            insertImageTag: () => insertImageTag(),
            handleEdit: (postId) => {
                const post = posts.find(p => p.id === postId);
                if (post) {
                    showEditForm(post);
                }
            }
        };

        // Gán sự kiện cho các nút
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('save-post-btn').addEventListener('click', () => {
                const title = document.getElementById('post-title').value;
                const content = document.getElementById('post-content-editor').innerHTML; // Lấy innerHTML
                const youtubeLink = document.getElementById('youtube-link').value;

                if (!title || !content.trim()) {
                    showMessage('Tiêu đề và Nội dung không được để trống.', true);
                    return;
                }
                savePost(title, content, youtubeLink);
            });

            document.getElementById('cancel-edit-btn').addEventListener('click', resetEditor);
            document.getElementById('add-post-btn').addEventListener('click', () => showEditForm(null));
            document.getElementById('insert-img-btn').addEventListener('click', insertImageTag);
            
            // Lắng nghe sự kiện chọn file
            document.getElementById('image-upload-input').addEventListener('change', handleImageUpload);
        });

    </script>
    <style>
        /* Thiết lập font Inter mặc định */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom styles cho line-clamp-3 (Đảm bảo tối đa 3 dòng hiển thị) */
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Style cho vùng soạn thảo HTML trực quan (thay thế textarea) */
        #post-content-editor {
            border: 1px solid #e2e8f0; /* gray-300 */
            padding: 1rem;
            min-height: 250px; /* Tăng chiều cao tối thiểu */
            background-color: #ffffff; /* white */
            border-radius: 0.5rem; /* rounded-lg */
            overflow-y: auto;
            cursor: text;
            /* Đảm bảo nó trông giống một textarea */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); 
        }
        /* Đảm bảo ảnh bên trong editor không bị quá lớn */
        #post-content-editor img {
            max-width: 100%;
            height: auto;
            object-fit: contain; /* Giữ tỷ lệ ảnh */
            border-radius: 0.5rem;
            margin: 1rem 0; /* Khoảng cách xung quanh ảnh */
        }
        /* Thêm placeholder giả cho contenteditable */
        #post-content-editor:empty:before {
            content: "Nội dung bài viết (có thể chèn ảnh và format text)...";
            color: #9ca3af; /* gray-400 */
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Modal Thông báo (Thay thế Alert) --><div id="message-modal" class="fixed top-5 right-5 z-50 p-4 rounded-lg text-white shadow-xl transition-opacity duration-500 opacity-0 hidden">
        <p id="message-text" class="font-semibold"></p>
    </div>

    <!-- Modal Xác nhận (Thay thế Confirm) --><div id="confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
            <p id="confirm-text" class="text-lg font-medium text-gray-700 mb-6">Bạn có chắc chắn muốn thực hiện hành động này không?</p>
            <div class="flex justify-end space-x-3">
                <button id="confirm-no" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition">Hủy</button>
                <button id="confirm-yes" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">Xác nhận</button>
            </div>
        </div>
    </div>


    <div class="container mx-auto p-4 sm:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-indigo-700">Blog Manager Đơn Giản</h1>
            <p id="current-user-id" class="text-sm text-gray-500 mt-2">ID Người dùng hiện tại: Đang tải...</p>
        </header>

        <!-- Phần Tạo Bài Viết (Mở cho tất cả người dùng) --><section id="post-creation-section" class="bg-white p-6 rounded-xl shadow-lg mb-8 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-gray-700">Tạo Bài Viết Mới</h2>
                <button id="add-post-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300 shadow-md">
                    + Viết Bài Mới
                </button>
            </div>

            <!-- Editor Container --><div id="edit-container" class="mt-4 p-4 border border-gray-200 rounded-lg hidden">
                <h3 id="editor-title" class="text-xl font-bold text-indigo-600 mb-4">Viết Bài Mới</h3>

                <!-- Input để chọn file (được ẩn đi) --><input type="file" id="image-upload-input" accept="image/*" class="hidden">

                <div class="space-y-4">
                    <input id="post-title" type="text" placeholder="Tiêu đề bài viết..." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                    
                    <label for="post-content-editor" class="block text-sm font-medium text-gray-700 mt-4">Nội dung bài viết (Chỉnh sửa trực quan):</label>
                    
                    <!-- VÙNG SOẠN THẢO TRỰC QUAN (THAY THẾ TEXTAREA VÀ PREVIEW) --><div id="post-content-editor" contenteditable="true" class="w-full focus:ring-indigo-500 focus:border-indigo-500">
                        <!-- Nội dung sẽ hiển thị dưới dạng HTML tại đây, bao gồm cả ảnh -->
                    </div>
                    
                    <div class="mt-4 flex flex-wrap gap-2 items-center">
                        <button id="insert-img-btn" class="bg-purple-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-purple-600 transition duration-300 text-sm shadow-md">
                            Tải Ảnh Lên & Chèn (Hiển thị trực quan)
                        </button>
                        <p class="text-sm text-gray-500">
                            *Ảnh được chuyển thành Base64 và chèn trực tiếp vào nội dung. Bạn có thể chỉnh sửa kích thước hoặc định dạng ngay trong ô này.
                        </p>
                    </div>

                    <input id="youtube-link" type="text" placeholder="Liên kết YouTube (ví dụ: youtube.com/watch?v=...) (tùy chọn)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button id="cancel-edit-btn" class="px-6 py-2 bg-gray-300 text-gray-800 rounded-lg font-semibold hover:bg-gray-400 transition">Hủy</button>
                    <button id="save-post-btn" class="px-6 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">Lưu Bài Viết</button>
                </div>
            </div>
        </section>

        <!-- Phần Hiển Thị Bài Viết (Dành cho User) --><section class="mt-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-400 pb-2">Danh Sách Bài Viết</h2>
            <div id="post-list">
                <!-- Bài viết sẽ được hiển thị tại đây theo thời gian thực --><p class="text-center text-gray-500 p-10">Đang tải bài viết...</p>
            </div>
        </section>

    </div>
</body>
</html>